(()=>{"use strict";const t=class{constructor(t,e=null){this.name=e,this.length=t,this.hitCoordinates=[]}getHitCoordinates(){return this.hitCoordinates}hit(t){this.hitCoordinates.push(t)}isSunk(){return this.length===this.hitCoordinates.length}},e=class{constructor(t=10){this.size=t}shipCoordinates=[];recordAttack=[];sunkShips=[];receiveAttack(t){this.recordAttack.push(t);for(let e=0;e<this.shipCoordinates.length;e++)for(let i=0;i<this.shipCoordinates[e].location.length;i++)if(t[0]===this.shipCoordinates[e].location[i][0]&&t[1]===this.shipCoordinates[e].location[i][1])return this.shipCoordinates[e].object.hit(t),"computer"===s.turn&&(s.cpuLastHit.push(t),2===s.cpuLastHit.length&&s.cpuLastHit.shift()),this.shipCoordinates[e].object.isSunk()&&(this.sunkShips.push(this.shipCoordinates[e].object),"computer"===s.turn&&(s.cpuLastHit=[])),void("computer"===s.turn&&s.turn)}removeShip(){return this.shipCoordinates.pop()}addShip(t,e){this.shipCoordinates.push({object:t,location:e})}randomAddShips(){let e=new t(5,"Carrier"),i=new t(4,"Battleship"),s=new t(2,"Destroyer"),n=new t(3,"Cruiser"),r=new t(3,"Submarine");this._randomizeShips(e),this._randomizeShips(i),this._randomizeShips(n),this._randomizeShips(s),this._randomizeShips(r)}_isEmptySpace(t){for(let e=0;e<this.shipCoordinates.length;e++)for(let i=0;i<this.shipCoordinates[e].location.length;i++)if(t[0]===this.shipCoordinates[e].location[i][0]&&t[1]===this.shipCoordinates[e].location[i][1])return!1;return!0}_randomizeShips(t,e=10){let i=[];const s=t.length;let n=this._defineAxis(),r=Math.floor(10*Math.random()),o=Math.floor(10*Math.random());if(i.push([r,o]),"x"===n&&r+s<=e)for(let t=0;t<s-1;t++)r++,i.push([r,o]);else if("x"===n&&r+s>e)for(let t=0;t<s-1;t++)r--,i.push([r,o]);if("y"===n&&o+s<=e)for(let t=0;t<s-1;t++)o++,i.push([r,o]);else if("y"===n&&o+s>e)for(let t=0;t<s-1;t++)o--,i.push([r,o]);for(let s=0;s<i.length;s++)if(!this._isEmptySpace(s))return this._randomizeShips(t,e);this.addShip(t,i)}_defineAxis(){return 1===Math.floor(2*Math.random())?"x":"y"}getSunkShips(){return this.sunkShips}allShipsSunk(){return 5===this.sunkShips.length}},i=class{constructor(t="Computer"){this.name=t}previousHit=[];attack(t,e){let i=[parseInt(t[0]),parseInt(t[1])];if(0===e.recordAttack.length)return e.receiveAttack(i),!0;for(let t=0;t<e.recordAttack.length;t++)return(i[0]!==e.recordAttack[t][0]||i[1]!==e.recordAttack[t][1])&&(e.receiveAttack(i),!0)}_cpuAttack(t){let e=Math.floor(Math.random())*t.size,i=Math.floor(Math.random())*t.size;return this.attack([e,i],t)}_defineAxis(){return 1===Math.floor(2*Math.random())?"x":"y"}_cpuSmartMove(t){let e=[];e=[...s.cpuLastHit[0]];let i=e;const n=this._defineAxis();let r=Math.random()<.5?-1:1;if("x"===n?i[0]+=r:"y"===n&&(i[1]+=r),!this._onAvailableSpace(i,t))return this._cpuSmartMove(t);this.attack(i,t)}_onAvailableSpace(t,e){-1===t[0]&&(t[0]+=2),-1===t[1]&&(t[1]+=2),10===t[0]&&(t[0]-=2),10===t[1]&&(t[1]-=2);for(let i=0;i<e.recordAttack.length;i++)if(t[0]===e.recordAttack[i][0]&&t[1]===e.recordAttack[i][1])return!1;return!0}_cpuKillMove(t){let e=[...s.cpuLastHit[0]],i=[...s.cpuLastHit[1]],n=[e,i],r=Math.random()<.5?-1:1;if(console.log(e,i),e[0]===i[0]&&1===Math.abs(e[1]-i[2])&&(n[1]+=r),e[1]===i[1]&&1===Math.abs(e[1]-i[2])&&(n[0]+=r),!this._onAvailableSpace())return this._cpuKillMove(t);this.attack(n,t)}_cpuAttackPattern(t){0===s.cpuLastHit.length?this._cpuAttack(t):this._cpuSmartMove(t)}};class s{static turn="player";static players=[];static boards=[];static mode="PvC";static wasHit=!1;static cpuLastHit=[];static cpuTargetingAid=[];static gameOver=!1}function*n(t){let e=[0,0];for(;e[0]<=t-1&&e[1]<=t-1;)0===e[0]&&0===e[1]&&(yield e),e[1]++,e[1]===t&&(e[0]++,e[1]=0),yield e}function r(t){t.addEventListener("click",(()=>{if("opponent"===s.turn||"computer"===s.turn)return void r(t);const e=s.players[1],i=s.boards[0],n=t.id.slice(1).split(",");e.attack(n,i),!0===s.wasHit?(t.classList.add("hit"),s.wasHit=!1):t.classList.add("miss"),"PvP"===s.mode?s.turn="opponent":(s.mode="PvC")&&(s.turn="computer")}),{once:!0})}function o(t){t.addEventListener("click",(()=>{if("player"===s.turn)return void o(t);const e=s.players[0],i=s.boards[1],n=t.id.slice(1).split(",");"PvP"===s.mode&&(e.attack(n,i),!0===s.wasHit?(t.classList.add("hit"),s.wasHit=!1):t.classList.add("miss")),s.turn="player"}),{once:!0})}(function(){const n=new e,r=new e;s.boards.push(n),s.boards.push(r);const o=new i("Jae"),a=new i;s.players.push(o),s.players.push(a);let h=new t(4,"Battleship"),c=new t(2,"Destroyer"),d=new t(3,"Cruiser"),p=new t(3,"Submarine"),l=new t(5,"Carrier");r.randomAddShips(),n.addShip(l,[[3,0],[3,1],[3,2],[3,3],[3,4]]),n.addShip(p,[[2,0],[2,1],[2,2]]),n.addShip(d,[[1,0],[1,1],[1,2]]),n.addShip(h,[[5,0],[5,1],[5,2],[5,3]]),n.addShip(c,[[4,0],[4,1]])})(),function(t=10){!function(t){const e=n(t),i=document.getElementById("current-player-board");for(let s=0;s<t*t;s++){const t=document.createElement("div");t.className="player-grid-elements",t.id=`a${e.next().value}`,r(t),i.appendChild(t)}}(t),"PvP"===s.mode?function(t){const e=n(t),i=document.getElementById("current-opponent-board");for(let s=0;s<t*t;s++){const t=document.createElement("div");t.className="opponent-grid-elements",t.id=`b${e.next().value}`,o(t),i.appendChild(t)}}(t):"PvC"===s.mode&&function(t){const e=n(t),i=document.getElementById("current-opponent-board");for(let s=0;s<t*t;s++){const t=document.createElement("div");t.className="opponent-grid-elements",t.id=`b${e.next().value}`,i.appendChild(t)}}(t)}()})();