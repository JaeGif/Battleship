(()=>{"use strict";class t{static turn="player";static players=[];static boards=[];static mode="PvP";static wasHit=!1;static cpuAttacked=[];static gameOver=!1;static justSunk="";static sunkEventFlag=!1}class e{static cpuLastHit=[];static cpuTargetingAid=[];static attempts=0}class n{static axis="x";static currentShip=[];static currentShipIndex=0;static currentPlacementBoard="player"}const s=class{constructor(t="Computer"){this.name=t}previousHit=[];attack(t,e){let n=[parseInt(t[0]),parseInt(t[1])];if(0===e.recordAttack.length)return e.receiveAttack(n),!0;for(let t=0;t<e.recordAttack.length;t++)return(n[0]!=e.recordAttack[t][0]||n[1]!=e.recordAttack[t][1])&&(e.receiveAttack(n),!0)}_cpuAttack(t){let e=Math.floor(10*Math.random()),n=Math.floor(10*Math.random());if(!this._onAvailableSpace([e,n],t))return this._cpuAttack(t);this.attack([e,n],t)}_defineAxis(){return 1===Math.floor(2*Math.random())?"x":"y"}_cpuSmartMove(t){const n=[[...e.cpuLastHit][0][0],[...e.cpuLastHit][0][1]];let s=[],a=n[0],i=n[1];return 0===e.attempts&&(a++,s.push(a),s.push(i)),1===e.attempts&&(i++,s.push(a),s.push(i)),2===e.attempts&&(i--,s.push(a),s.push(i)),3===e.attempts&&(a--,s.push(a),s.push(i)),-1===s[0]||-1===s[1]||10===s[0]||10===s[1]||!this._onAvailableSpace(s,t)&&e.attempts<4?(e.attempts++,this._cpuSmartMove(t)):this._onAvailableSpace(s,t)&&e.attempts<4?(e.attempts=0,this.attack(s,t)):(e.attempts=0,void this._cpuAttack(t))}_onAvailableSpace(t,e){for(let n=0;n<e.recordAttack.length;n++)if(t[0]===e.recordAttack[n][0]&&t[1]===e.recordAttack[n][1])return!1;return!0}cpuAttackPattern(t){0===e.cpuLastHit.length?this._cpuAttack(t):this._cpuSmartMove(t)}};function a(){return new Audio("assets/sfx/hit.wav")}function i(){return new Audio("assets/sfx/miss.mp3")}function r(t){const e=o(t),n=document.getElementById("current-opponent-board");for(let s=0;s<t*t;s++){const t=document.createElement("div");t.className="opponent-grid-elements",t.id=`b${e.next().value}`,c(t),n.appendChild(t)}}function*o(t){let e=[0,0];for(;e[0]<=t-1&&e[1]<=t-1;)0===e[0]&&0===e[1]&&(yield e),e[1]++,e[1]===t&&(e[0]++,e[1]=0),yield e}function c(e){e.addEventListener("click",(()=>{let n="";const s=a(),r=i(),o=document.getElementById("turn");if("player"!==t.turn)return void c(e);const l=[...t.players][0],p=[...t.boards][1],u=e.id.slice(1).split(",");l.attack(u,p),p.allShipsSunk()&&(t.gameOver=!0,S()),!0===t.wasHit?(s.play(),e.classList.add("hit"),n="Its a hit!",!0===t.sunkEventFlag&&(n=`You sunk the ${t.justSunk}!`,t.sunkEventFlag=!1),t.wasHit=!1):(r.play(),n="Miss...",e.classList.add("miss")),"PvP"===t.mode?(t.turn="opponent",o.textContent=`${n} It's ${d()}'s Turn!`):"PvC"===t.mode&&(t.turn="computer",o.textContent=`${n} It's ${d()}'s Turn!`,async function(){let e="";const n=document.getElementById("turn");await function(){const t=1500*Math.random();return new Promise((e=>setTimeout(e,t)))}();const s=a(),r=i(),o=[...t.players][1],c=[...t.boards][0];o.cpuAttackPattern(c);let l=[...t.cpuAttacked][0][0]+","+[...t.cpuAttacked][0][1];t.cpuAttacked=[];const p=document.getElementById(`a${l}`);c.allShipsSunk()&&(t.gameOver=!0,S()),!0===t.wasHit?(s.play(),p.classList.remove("reveal"),p.classList.add("hit"),e="Its a hit!",!0===t.sunkEventFlag&&(e=`Computer sunk the ${t.justSunk}!`,t.sunkEventFlag=!1),t.wasHit=!1):(r.play(),e="Miss...",p.classList.add("miss")),t.turn="player",n.textContent=`${e} It's ${d()}'s Turn!`}())}),{once:!0})}function l(e){e.addEventListener("click",(()=>{const n=a(),s=i();let r="";const o=document.getElementById("turn");if("player"===t.turn)return void l(e);const c=[...t.players][1],p=[...t.boards][0],u=e.id.slice(1).split(",");"PvP"===t.mode&&(c.attack(u,p),!0===t.wasHit?(n.play(),e.classList.add("hit"),r="Its a hit!",!0===t.sunkEventFlag&&(r=`You sunk the ${t.justSunk}!`,t.sunkEventFlag=!1),t.wasHit=!1):(s.play(),e.classList.add("miss"),r="Miss...")),p.allShipsSunk()&&(t.gameOver=!0,S()),t.turn="player",o.textContent=`${r} It's ${d()}'s Turn!`}),{once:!0})}function d(){const e=[...t.boards][0],n=[...t.boards][1];switch(t.turn){case"player":return""===e.name?"Player 1":e.name;case"opponent":return""===n.name?"Player 2":n.name;case"computer":return"Computer"}}const p=class{constructor(t,e=null){this.name=e,this.length=t,this.hitCoordinates=[]}getHitCoordinates(){return this.hitCoordinates}hit(t){this.hitCoordinates.push(t)}isSunk(){return this.length===this.hitCoordinates.length}};function u(e){e.addEventListener("dragover",(t=>{t.preventDefault();let s=e.id;if(s=s.split(","),"x"===n.axis)for(let t=0;t<n.currentShip[n.currentShipIndex].shipObj.length;t++){let e=s[0]+","+(parseInt(s[1])+t);document.getElementById(`${e}`)}})),e.addEventListener("dragleave",(t=>{let s=e.id;if(s=s.split(","),"x"===n.axis)for(let t=0;t<n.currentShip[n.currentShipIndex].shipObj.length;t++){let e=s[0]+","+(parseInt(s[1])+t);document.getElementById(`${e}`)}})),e.addEventListener("drop",(s=>{s.preventDefault();let a=e.id;a=a.split(",");let i=[];if("x"===n.axis&&parseInt(a[1])+n.currentShip[n.currentShipIndex].shipObj.length-1>9||"y"===n.axis&&parseInt(a[0])+n.currentShip[n.currentShipIndex].shipObj.length-1>9)return!1;if("x"===n.axis)for(let t=0;t<n.currentShip[n.currentShipIndex].shipObj.length;t++)i.push([parseInt(a[0]),parseInt(a[1])+t]);if("y"===n.axis)for(let t=0;t<n.currentShip[n.currentShipIndex].shipObj.length;t++)i.push([parseInt(a[0])+t,parseInt(a[1])]);if(!function(e){let s;s="player"===n.currentPlacementBoard?[...t.boards][0]:[...t.boards][1];for(let t=0;t<e.length;t++)for(let n=0;n<s.shipCoordinates.length;n++)for(let a=0;a<s.shipCoordinates[n].location.length;a++)if(e[t][0]===s.shipCoordinates[n].location[a][0]&&e[t][1]===s.shipCoordinates[n].location[a][1])return!1;return!0}(i))return!1;const r=s.dataTransfer.getData("text"),o=document.getElementById(r);var c;s.target.appendChild(o),o.setAttribute("draggable",!1),c=i,"player"===n.currentPlacementBoard?[...t.boards][0].addShip([...n.currentShip][n.currentShipIndex].shipObj,c):"opponent"===n.currentPlacementBoard&&[...t.boards][1].addShip([...n.currentShip][n.currentShipIndex].shipObj,c),h(),m(),n.currentShipIndex<5&&y()}))}function m(){if(n.currentShipIndex++,n.currentShipIndex>=5){const e=document.getElementById("game"),s=document.getElementById("placement-page-body-container");if("PvC"===t.mode)[...t.boards][1].randomAddShips();else if("PvP"===t.mode&&"player"===n.currentPlacementBoard)return function(){h(),n.currentShip=[],n.currentShipIndex=0,n.currentPlacementBoard="opponent";const t=document.getElementById("placement-board");for(;t.firstChild;)t.removeChild(t.lastChild);const e=document.getElementById("unplaced-ship-container");for(;e.firstChild;)e.lastChild.className="",e.removeChild(e.lastChild)}(),g();s.style.display="none",e.style.display="flex",function(e=10){!async function(){const t=await fetch("https://api.giphy.com/v1/gifs/o0eOCNkn7cSD6?api_key=XQjjxBQQYTlh7yBaVu1JXQ6YbH5dno3B&s=cats",{mode:"cors"}),e=await t.json();document.getElementById("gg-img").src=e.data.images.original.url}();const n=document.getElementById("game");document.body.style.backgroundImage="none",async function(){const t=await fetch("https://api.giphy.com/v1/gifs/XPlcxsFs8BIKk?api_key=XQjjxBQQYTlh7yBaVu1JXQ6YbH5dno3B&s=cats",{mode:"cors"}),e=await t.json();document.body.style.backgroundImage=`url(${e.data.images.original.url})`}();const s=document.getElementById("placement-page-body-container");!function(){const e=[...t.boards][0],n=[...t.boards][1],s=document.getElementById("player-name"),a=document.getElementById("player-2-name");""===e.name?s.textContent="Player 1":s.textContent=`${e.name}`,""===n.name?a.textContent="Player 2":a.textContent=`${n.name}`}(),function(t){const e=o(t),n=document.getElementById("current-player-board");for(let s=0;s<t*t;s++){const t=document.createElement("div");t.className="player-grid-elements",t.id=`a${e.next().value}`,l(t),n.appendChild(t)}}(e),"PvP"===t.mode?r(e):"PvC"===t.mode&&(function(){let e="";const n=[...t.boards][0];for(let t=0;t<n.shipCoordinates.length;t++)for(let s=0;s<n.shipCoordinates[t].location.length;s++)e=n.shipCoordinates[t].location[s][0]+","+n.shipCoordinates[t].location[s][1],document.getElementById(`a${e}`).classList.add("reveal")}(),r(e)),s.style.display="none",n.style.display="flex",document.getElementById("turn").textContent=`${d()} start your offensive!`}()}}function h(){n.axis="x",document.getElementById("unplaced-ship-container").style.height="fit-content"}function y(){const t=document.createElement("img");t.className="ship-img";const e=document.getElementById("ship-name"),s=document.getElementById("ship-length");document.getElementById("unplaced-ship-container").appendChild(t),function(){let t;n.currentPlacementBoard,t=document.getElementsByClassName("ship-img")[n.currentShipIndex],t.addEventListener("dragstart",(t=>{t.dataTransfer.clearData(),t.dataTransfer.setData("text/plain",t.target.id)}))}(),t.id=`${[...n.currentShip][n.currentShipIndex].shipObj.name}`,t.src=`${[...n.currentShip][n.currentShipIndex].shipSrcImg}`,e.textContent=`Name: ${[...n.currentShip][n.currentShipIndex].shipObj.name}`,s.textContent=`Length: ${[...n.currentShip][n.currentShipIndex].shipObj.length}`,t.setAttribute("draggable",!0)}function g(){document.getElementById("randomize-button").addEventListener("click",f);const e=document.getElementById("placement-board-name");let s=[...t.players][1].name;""===s&&(s="Player 2"),e.textContent=`${s}'s board`,document.getElementById("placement-page-body-container").display="flex",function(t=10){const e=o(t),n=document.getElementById("placement-board");for(let s=0;s<t*t;s++){const t=document.createElement("div");t.id=`${e.next().value}`,u(t),n.appendChild(t)}}(),function(){let t=[{shipObj:new p(5,"carrier"),shipSrcImg:"assets/ships/carrier.png"},{shipObj:new p(4,"battleship"),shipSrcImg:"assets/ships/battleship.png"},{shipObj:new p(2,"destroyer"),shipSrcImg:"assets/ships/gamsi.png"},{shipObj:new p(3,"cruiser"),shipSrcImg:"assets/ships/frigate.png"},{shipObj:new p(3,"submarine"),shipSrcImg:"assets/ships/submarine.png"}];n.currentShip=t}(),"player"===n.currentPlacementBoard&&(s=[...t.players][0].name,""===s&&(s="Player 1"),e.textContent=`${s}'s board`,y(),function(){const t=document.getElementById("unplaced-ship-container"),e=6*[...n.currentShip][n.currentShipIndex].shipObj.length;document.getElementById("change-orientation").addEventListener("click",(()=>{let s=document.getElementsByClassName("ship-img");"x"===n.axis?(n.axis="y",s[n.currentShipIndex].classList.add("y"),t.style.height=`${e}vh`):(n.axis="x",s[n.currentShipIndex].classList.remove("y"),t.style.height="fit-content")}))}())}function f(){"player"===n.currentPlacementBoard?(document.getElementById("randomize-button").removeEventListener("click",f),[...t.boards][0].randomAddShips(),n.currentShipIndex=5,m(),y()):"opponent"===n.currentPlacementBoard&&([...t.boards][1].randomAddShips(),n.currentShipIndex=5,m())}function I(){g()}function S(){!function(){const e=document.getElementById("game-over-modal"),n=document.getElementById("winner-name"),s=document.getElementById("num-remaining"),a=document.getElementsByClassName("replay-btn")[0];let i,r=0;[...t.boards][0].allShipsSunk()?(i=[...t.players][1].name,r=5-[...t.boards][1].sunkShips.length):(i=[...t.players][0].name,r=5-[...t.boards][0].sunkShips.length),n.textContent=`${i} Won!`,s.textContent=`${i} had ${r} left!`,e.style.display="flex",a.addEventListener("click",(()=>{location.reload()}))}()}const E=class{constructor(t,e=10){this.name=t,this.size=e}shipCoordinates=[];recordAttack=[];sunkShips=[];receiveAttack(n){this.recordAttack.push(n),"computer"===t.turn&&t.cpuAttacked.push(n);for(let s=0;s<this.shipCoordinates.length;s++)for(let a=0;a<this.shipCoordinates[s].location.length;a++)if(n[0]===this.shipCoordinates[s].location[a][0]&&n[1]===this.shipCoordinates[s].location[a][1])return this.shipCoordinates[s].object.hit(n),t.wasHit=!0,"computer"===t.turn&&(e.cpuLastHit.push(n),2===e.cpuLastHit.length&&e.cpuLastHit.shift()),this.shipCoordinates[s].object.isSunk()&&(this.sunkShips.push(this.shipCoordinates[s].object),t.justSunk=this.shipCoordinates[s].object.name,t.sunkEventFlag=!0,"computer"===t.turn&&(e.cpuLastHit=[])),!0;return!1}removeShip(){return this.shipCoordinates.pop()}addShip(t,e){this.shipCoordinates.push({object:t,location:e})}randomAddShips(){let t=new p(5,"Carrier"),e=new p(4,"Battleship"),n=new p(2,"Destroyer"),s=new p(3,"Cruiser"),a=new p(3,"Submarine");this._randomizeShips(t),this._randomizeShips(e),this._randomizeShips(s),this._randomizeShips(n),this._randomizeShips(a)}_isEmptySpace(t){for(let e=0;e<this.shipCoordinates.length;e++)for(let n=0;n<this.shipCoordinates[e].location.length;n++)if(t[0]===this.shipCoordinates[e].location[n][0]&&t[1]===this.shipCoordinates[e].location[n][1])return!1;return!0}_randomizeShips(t,e=10){let n=[];const s=t.length;let a=this._defineAxis(),i=Math.floor(10*Math.random()),r=Math.floor(10*Math.random());if(n.push([i,r]),"x"===a&&i+s<=e)for(let t=0;t<s-1;t++)i++,n.push([i,r]);else if("x"===a&&i+s>e)for(let t=0;t<s-1;t++)i--,n.push([i,r]);if("y"===a&&r+s<=e)for(let t=0;t<s-1;t++)r++,n.push([i,r]);else if("y"===a&&r+s>e)for(let t=0;t<s-1;t++)r--,n.push([i,r]);if(!this._isEmptySpace(n[0]))return this._randomizeShips(t,e);this.addShip(t,n)}_defineAxis(){return 1===Math.floor(2*Math.random())?"x":"y"}getSunkShips(){return this.sunkShips}allShipsSunk(){return 5===this.sunkShips.length}};function v(){const t=document.getElementById("options-menu"),e=document.getElementById("menu");document.getElementById("credits-scroll").style.display="none",t.style.display="none",e.style.display="flex"}!function(){const e=document.getElementById("play"),n=document.getElementById("play-card");e.addEventListener("click",(()=>{n.style.display="none",function(){(function(){const t=new Audio("assets/sfx/we-are-8-bit.mp3");return t.loop=!0,t})().play();const e=document.getElementById("menu");e.style.display="flex";const n=document.getElementById("pvc"),a=document.getElementById("multiplayer"),i=document.getElementById("options"),r=document.getElementById("single-player-name"),o=document.getElementById("multiplayer-name"),c=document.getElementById("return-to-menu");n.addEventListener("click",(()=>{t.mode="PvC",r.style.display="flex",o.style.display="none"})),a.addEventListener("click",(()=>{t.mode="PvP",r.style.display="none",o.style.display="flex"})),i.addEventListener("click",(()=>{const t=document.getElementById("options-menu"),n=document.getElementById("credits"),s=document.getElementById("credits-scroll");n.addEventListener("click",(()=>{s.style.display="flex"})),e.style.display="none",t.style.display="flex",c.addEventListener("click",(()=>{v()})),window.addEventListener("keypress",(function(t){"Enter"===t.key&&v()}))})),function(){const e=document.getElementById("new-game-btn-solo"),n=document.getElementById("new-game-btn-multiplayer"),a=(document.getElementById("single-player-name"),document.getElementById("multiplayer-name"),document.getElementById("menu")),i=document.getElementById("placement-page-body-container"),r=document.getElementById("single-player-input"),o=document.getElementById("player1-input"),c=document.getElementById("player2-input");e.addEventListener("click",(()=>{let e=new s(r.value),n=new s("Computer");t.players.push(e),t.players.push(n);const o=new E(r.value),c=new E("Computer");t.boards.push(o),t.boards.push(c),i.style.display="flex",a.style.display="none",I()})),n.addEventListener("click",(()=>{let e=new s(o.value),n=new s(c.value);t.players.push(e),t.players.push(n);const r=new E(o.value),l=new E(c.value);t.boards.push(r),t.boards.push(l),i.style.display="flex",a.style.display="none",I()}))}()}()}))}()})();